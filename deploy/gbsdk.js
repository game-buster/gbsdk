var GBSDK=(function(exports){'use strict';/* GBSDK v1.0.0 - Core Ads SDK | https://github.com/gamebuster/gbsdk */
var Q=Object.defineProperty;var k=(a,r)=>()=>(a&&(r=a(a=0)),r);var X=(a,r)=>{for(var e in r)Q(a,e,{get:r[e],enumerable:true});};function V(a){return j.has(a)?Promise.resolve():new Promise((r,e)=>{let t=document.createElement("script");t.src=a,t.async=true,t.onload=()=>{j.add(a),r();},t.onerror=()=>{e(new Error(`Failed to load script: ${a}`));},document.head.appendChild(t);})}function N(a,r){let e=new URL(a);return Object.entries(r).forEach(([t,i])=>{i!=null&&e.searchParams.set(t,String(i));}),e.toString()}async function F(a,r={}){let{timeout:e=1e4,...t}=r,i=new AbortController,o=setTimeout(()=>i.abort(),e);try{let n=await fetch(a,{...t,signal:i.signal});clearTimeout(o);let s={};return n.headers.forEach((d,c)=>{s[c.toLowerCase()]=d;}),{ok:n.ok,status:n.status,statusText:n.statusText,headers:s,text:()=>n.text(),json:()=>n.json()}}catch(n){throw clearTimeout(o),n instanceof Error&&n.name==="AbortError"?new Error(`Request timeout: ${a}`):n}}function $(a){if(new URL(a).protocol!=="https:")throw new Error(`GBSDK: Only HTTPS URLs are allowed: ${a}`)}function W(a,r){if(r.length===0)return;let t=new URL(a).hostname;if(!r.some(o=>t===o||t.endsWith(`.${o}`)))throw new Error(`GBSDK: Domain not allowed: ${t}. Allowed: ${r.join(", ")}`)}var j,G=k(()=>{j=new Set;});function z(){let a=document.getElementById("gbsdk-overlay");a||(a=Z());let r=a.querySelector("#gbsdk-slot"),e=a.querySelector("#gbsdk-video"),t=a.querySelector("#gbsdk-close");if(!r||!e||!t)throw new Error("GBSDK: Overlay elements not found");return {overlay:a,slot:r,video:e,closeBtn:t}}function Z(){let a=document.createElement("div");a.id="gbsdk-overlay",a.className="gbsdk-overlay",a.style.display="none";let r=document.createElement("div");r.id="gbsdk-slot",r.className="gbsdk-slot";let e=document.createElement("video");e.id="gbsdk-video",e.className="gbsdk-video",e.muted=true,e.playsInline=true,e.controls=false;let t=document.createElement("button");return t.id="gbsdk-close",t.className="gbsdk-close",t.innerHTML="\xD7",t.setAttribute("aria-label","Close"),t.type="button",r.appendChild(e),a.appendChild(r),a.appendChild(t),document.body.appendChild(a),a}function H(a){m=document.activeElement,a.style.display="flex";let r=a.querySelector("#gbsdk-close");r&&r.focus(),document.body.style.overflow="hidden";}function u(a){if(a.style.display="none",document.body.style.overflow="",m&&document.contains(m))try{m.focus();}catch{}m=null;}function L(a){try{a.pause(),a.src="",a.load();}catch{}}function B(a){let r=a.getBoundingClientRect();return {width:r.width||window.innerWidth,height:r.height||window.innerHeight}}function _(a,r,e=960){let t=1.7777777777777777,i=Math.min(a*.9,e),o=i/t;return o>r*.8&&(o=r*.8,i=o*t),{width:Math.floor(i),height:Math.floor(o)}}var m,R=k(()=>{m=null;});var q={};X(q,{ImaVastAdapter:()=>h});var Y,h,A=k(()=>{G();R();Y="https://imasdk.googleapis.com/js/sdkloader/ima3.js",h=class{constructor(){this.name="ImaVast";this.adsLoader=null;this.adsManager=null;this.adDisplayContainer=null;this.currentPlayCtx=null;this.playPromiseResolve=null;this.playTimeout=null;}async load(){if(await V(Y),!window.google?.ima)throw new Error("Google IMA SDK failed to load");try{window.google.ima.settings.setVpaidMode(window.google.ima.settings.VpaidMode.DISABLED);}catch(r){console.warn("GBSDK: Could not disable VPAID:",r);}}supports(r){return r==="interstitial"||r==="rewarded"}async play(r,e){return new Promise(t=>{this.currentPlayCtx=e,this.playPromiseResolve=t,e.debug&&console.log("ImaVastAdapter: Starting ad request",{tagUrl:r}),this.playTimeout=window.setTimeout(()=>{this.handleTimeout();},15e3);try{this.initializeAd(r,e);}catch(i){this.cleanup(),e.onEvent("error",{error:i instanceof Error?i.message:"Unknown error"}),t("error");}})}initializeAd(r,e){let{mount:t,tc:i,debug:o}=e;this.adDisplayContainer=new window.google.ima.AdDisplayContainer(t.video,t.slot);try{this.adDisplayContainer.initialize(),o&&console.log("ImaVastAdapter: Ad display container initialized");}catch(c){o&&console.error("ImaVastAdapter: Failed to initialize ad display container",c);}this.adsLoader=new window.google.ima.AdsLoader,this.adsLoader.addEventListener(window.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,c=>this.onAdsManagerLoaded(c),false),this.adsLoader.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,c=>this.onAdError(c),false);let n=new window.google.ima.AdsRequest;n.adTagUrl=this.buildAdTagUrl(r,i);let s=B(t.overlay),d=_(s.width,s.height);n.linearAdSlotWidth=d.width,n.linearAdSlotHeight=d.height,n.nonLinearAdSlotWidth=d.width,n.nonLinearAdSlotHeight=Math.floor(d.height*.3),o&&console.log("GBSDK: IMA request:",{adTagUrl:n.adTagUrl,dimensions:d}),this.adsLoader.requestAds(n);}buildAdTagUrl(r,e){let t={correlator:Date.now()};return e&&(e.gdpr!==void 0&&(t.gdpr=e.gdpr),e.tcString&&(t.gdpr_consent=e.tcString),e.npa!==void 0&&(t.npa=e.npa)),N(r,t)}onAdsManagerLoaded(r){this.currentPlayCtx?.debug&&console.log("ImaVastAdapter: Ads manager loaded");let e={};e.restoreCustomPlaybackStateOnAdBreakComplete=true,this.adsManager=r.getAdsManager(this.currentPlayCtx.mount.video,e),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.LOADED,()=>this.onAdEvent("loaded")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.STARTED,()=>this.onAdEvent("started")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.FIRST_QUARTILE,()=>this.onAdEvent("first_quartile")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.MIDPOINT,()=>this.onAdEvent("midpoint")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.THIRD_QUARTILE,()=>this.onAdEvent("third_quartile")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.COMPLETE,()=>this.onAdEvent("complete")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.SKIPPED,()=>this.onAdEvent("skipped")),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.ALL_ADS_COMPLETED,()=>this.onAdEvent("all_completed")),this.adsManager.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,t=>this.onAdError(t));try{let t=B(this.currentPlayCtx.mount.overlay),i=_(t.width,t.height);this.currentPlayCtx.debug&&console.log("ImaVastAdapter: Initializing ads manager",{width:i.width,height:i.height}),this.adsManager.init(i.width,i.height,window.google.ima.ViewMode.NORMAL),this.currentPlayCtx.debug&&console.log("ImaVastAdapter: Starting ads manager"),this.adsManager.start(),this.currentPlayCtx.debug&&console.log("ImaVastAdapter: Ads manager started successfully");}catch(t){this.currentPlayCtx.debug&&console.error("ImaVastAdapter: Failed to start ads manager",t),this.onAdError({getError:()=>({getMessage:()=>t instanceof Error?t.message:"Init error"})});}}onAdEvent(r){this.currentPlayCtx&&(this.currentPlayCtx.onEvent(r),r==="complete"?this.resolvePlay("ok"):r==="skipped"?this.currentPlayCtx.kind==="rewarded"?this.resolvePlay("skipped"):this.resolvePlay("ok"):r==="all_completed"&&this.resolvePlay("ok"));}onAdError(r){let e=r.getError?r.getError():r,t=e.getMessage?e.getMessage():"",i=e.getErrorCode?e.getErrorCode():"unknown",o=e.getType?e.getType():"unknown",n=e.getVastErrorCode?e.getVastErrorCode():null,s=e.getInnerError?e.getInnerError():null,d=t;!d&&i!=="unknown"&&(d=`IMA Error ${i}`),!d&&n&&(d=`VAST Error ${n}`),d||(d="Unknown ad error - VAST response may be empty or invalid"),this.currentPlayCtx&&(this.currentPlayCtx.debug&&console.error("ImaVastAdapter: Ad error",{message:d,originalMessage:t,errorCode:i,errorType:o,vastErrorCode:n,innerError:s,fullError:e}),this.currentPlayCtx.onEvent("error",{error:d,errorCode:i,errorType:o})),this.resolvePlay("error");}handleTimeout(){this.currentPlayCtx&&this.currentPlayCtx.onEvent("timeout"),this.resolvePlay("timeout");}resolvePlay(r){this.playPromiseResolve&&(this.playPromiseResolve(r),this.playPromiseResolve=null),this.cleanup();}cleanup(){if(this.playTimeout&&(clearTimeout(this.playTimeout),this.playTimeout=null),this.adsManager){try{this.adsManager.destroy();}catch{}this.adsManager=null;}if(this.adsLoader){try{this.adsLoader.destroy();}catch{}this.adsLoader=null;}this.adDisplayContainer=null,this.currentPlayCtx=null;}destroy(){this.cleanup();}};});var f=class{constructor(){this.listeners=new Map;}on(r,e){this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(e);}off(r,e){let t=this.listeners.get(r);t&&(t.delete(e),t.size===0&&this.listeners.delete(r));}removeAllListeners(r){r?this.listeners.delete(r):this.listeners.clear();}emit(r,e){let t=this.listeners.get(r);if(t){let i=Array.from(t);for(let o of i)try{o(e);}catch(n){console.error(`GBSDK: Error in event listener for ${r}:`,n);}}}listenerCount(r){let e=this.listeners.get(r);return e?e.size:0}hasListeners(r){return this.listenerCount(r)>0}eventNames(){return Array.from(this.listeners.keys())}};G();var y=class{constructor(r){this.storage=r;}getItem(r){try{return this.storage.getItem(r)}catch(e){return console.warn(`GBSDK: Failed to get item from storage: ${r}`,e),null}}setItem(r,e){try{this.storage.setItem(r,e);}catch(t){console.warn(`GBSDK: Failed to set item in storage: ${r}`,t);}}removeItem(r){try{this.storage.removeItem(r);}catch(e){console.warn(`GBSDK: Failed to remove item from storage: ${r}`,e);}}},p=new y(window.localStorage),I=new y(window.sessionStorage);function w(a,r){let e=a.getItem(r);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.warn(`GBSDK: Failed to parse JSON from storage: ${r}`,t),null}}function v(a,r,e){try{a.setItem(r,JSON.stringify(e));}catch(t){console.warn(`GBSDK: Failed to store JSON: ${r}`,t);}}var b=class{constructor(r){this.options=r,this.cacheKeyData=`${r.storageKey}:rc:data`,this.cacheKeyEtag=`${r.storageKey}:rc:etag`,this.cacheKeyTimestamp=`${r.storageKey}:rc:ts`;}async fetch(){try{$(this.options.url),this.options.allowDomains.length>0&&W(this.options.url,this.options.allowDomains);let r=this.getCachedConfig(),e=Date.now();if(r&&e-r.timestamp<this.options.refreshSec*1e3)return this.options.debug&&console.log("GBSDK: Using fresh cached config"),r.data;try{let t=await this.fetchFromNetwork(r?.etag);if(t)return this.options.debug&&console.log("GBSDK: Fetched new config from network"),t;if(r)return this.updateCacheTimestamp(),this.options.debug&&console.log("GBSDK: Config not modified, using cached version"),r.data}catch(t){if(console.warn("GBSDK: Failed to fetch remote config:",t),r)return this.options.debug&&console.log("GBSDK: Using stale cached config due to fetch error"),r.data}return}catch(r){console.error("GBSDK: Error in remote config fetch:",r);return}}async fetchFromNetwork(r){let e={Accept:"application/json"};r&&(e["If-None-Match"]=r),this.options.auth&&(e[this.options.auth.header]=this.options.auth.token);let t=await F(this.options.url,{method:"GET",headers:e,timeout:1e4});if(t.status===304)return null;if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let i=await t.text(),o=JSON.parse(i);if(this.validateConfig(o),this.options.publicKey&&o.signature&&!await this.verifySignature(i,o.signature))throw new Error("Invalid configuration signature");let n=t.headers.etag||"";return this.cacheConfig(o,n),o}getCachedConfig(){let r=w(p,this.cacheKeyData),e=p.getItem(this.cacheKeyEtag),t=p.getItem(this.cacheKeyTimestamp);if(!r||!t)return null;let i=parseInt(t,10);return isNaN(i)?null:{data:r,etag:e||"",timestamp:i}}cacheConfig(r,e){let t=Date.now();v(p,this.cacheKeyData,r),p.setItem(this.cacheKeyEtag,e),p.setItem(this.cacheKeyTimestamp,t.toString());}updateCacheTimestamp(){let r=Date.now();p.setItem(this.cacheKeyTimestamp,r.toString());}validateConfig(r){if(!r||typeof r!="object")throw new Error("Invalid config: must be an object");if(!r.version||typeof r.version!="string")throw new Error("Invalid config: version is required and must be a string");if(r.cooldownSec!==void 0&&(typeof r.cooldownSec!="number"||r.cooldownSec<0))throw new Error("Invalid config: cooldownSec must be a non-negative number");if(r.sessionCap!==void 0&&(typeof r.sessionCap!="number"||r.sessionCap<0))throw new Error("Invalid config: sessionCap must be a non-negative number");if(r.interstitial&&!Array.isArray(r.interstitial.tags))throw new Error("Invalid config: interstitial.tags must be an array");if(r.rewarded&&!Array.isArray(r.rewarded.tags))throw new Error("Invalid config: rewarded.tags must be an array")}async verifySignature(r,e){return this.options.publicKey&&console.warn("GBSDK: Signature verification not implemented - accepting all signatures"),true}clearCache(){p.removeItem(this.cacheKeyData),p.removeItem(this.cacheKeyEtag),p.removeItem(this.cacheKeyTimestamp);}};A();var S=class{constructor(){this.loaded=false;this.loadPromise=null;this.adUnitCounter=0;}async load(){if(!this.loaded)return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise((r,e)=>{if(window.pbjs&&window.pbjs.que){this.loaded=true,r();return}window.pbjs=window.pbjs||{que:[]};let t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/prebid.js@latest/dist/prebid.js",t.async=true,t.onload=()=>{this.loaded=true,r();},t.onerror=()=>{e(new Error("Failed to load Prebid.js"));},document.head.appendChild(t);}),this.loadPromise)}async play(r,e){return this.loaded||await this.load(),new Promise(t=>{let i=`gbsdk-${e.kind}-${++this.adUnitCounter}`,o=r.timeout||2e3;e.debug&&console.log("PrebidAdapter: Starting header bidding",{adUnitCode:i,config:r}),window.pbjs.que.push(()=>{try{window.pbjs.setConfig({priceGranularity:r.priceGranularity||"medium",enableSendAllBids:r.enableSendAllBids!==!1,userSync:{syncEnabled:!0,filterSettings:{iframe:{bidders:"*",filter:"include"}}}});let n={code:i,mediaTypes:{video:{context:"instream",playerSize:[640,480],mimes:["video/mp4","video/webm"],protocols:[2,3,5,6],playbackmethod:[2],skip:e.kind==="interstitial"?1:0}},bids:r.bidders.map(s=>({bidder:s.name,params:s.params}))};window.pbjs.addAdUnits([n]),window.pbjs.requestBids({adUnitCodes:[i],timeout:o,bidsBackHandler:s=>{this.handleBidsBack(i,s,e,t);}}),setTimeout(()=>{e.debug&&console.log("PrebidAdapter: Timeout reached"),this.cleanup(i),t("timeout");},o+500);}catch(n){e.debug&&console.error("PrebidAdapter: Error",n),this.cleanup(i),t("error");}});})}handleBidsBack(r,e,t,i){try{let o=window.pbjs.getHighestCpmBids(r);if(t.debug&&console.log("PrebidAdapter: Bids received",{highestBids:o}),!o||o.length===0){t.debug&&console.log("PrebidAdapter: No bids"),this.cleanup(r),t.onEvent("no_fill",{}),i("no_fill");return}let n=o[0];if(!n.vastUrl&&!n.vastXml){t.debug&&console.log("PrebidAdapter: No VAST in winning bid"),this.cleanup(r),t.onEvent("no_fill",{}),i("no_fill");return}let s=n.vastUrl,d=n.vastXml;t.debug&&console.log("PrebidAdapter: Playing winning bid",{cpm:n.cpm,bidder:n.bidder,vastUrl:s,hasVastXml:!!d}),this.playVastAd(s,d,t,i);}catch(o){t.debug&&console.error("PrebidAdapter: Error handling bids",o),this.cleanup(r),i("error");}}async playVastAd(r,e,t,i){try{let{ImaVastAdapter:o}=await Promise.resolve().then(()=>(A(),q)),n=new o;if(await n.load(),r){let s=await n.play(r,t);i(s);}else t.onEvent("no_fill",{}),i("no_fill");}catch(o){t.debug&&console.error("PrebidAdapter: Error playing VAST",o),i("error");}}cleanup(r){try{window.pbjs?.removeAdUnit(r);}catch{}}destroy(){this.loaded=false,this.loadPromise=null;}};var E=class{constructor(){this.loaded=false;this.loadPromise=null;this.slotCounter=0;this.currentSlot=null;}async load(){if(!this.loaded)return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise((r,e)=>{if(window.googletag&&window.googletag.cmd){this.loaded=true,r();return}window.googletag=window.googletag||{cmd:[]};let t=document.createElement("script");t.src="https://securepubads.g.doubleclick.net/tag/js/gpt.js",t.async=true,t.onload=()=>{window.googletag.cmd.push(()=>{this.loaded=true,r();});},t.onerror=()=>{e(new Error("Failed to load Google Publisher Tag"));},document.head.appendChild(t);}),this.loadPromise)}async play(r,e){return this.loaded||await this.load(),new Promise(t=>{let i=`gam-ad-${++this.slotCounter}`,o=r.timeout||3e3,n=null,s=false;e.debug&&console.log("GAMAdapter: Starting ad request",{divId:i,config:r});let d=document.createElement("div");d.id=i,d.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;",e.mount.overlay.appendChild(d),window.googletag.cmd.push(()=>{try{let c=r.adUnitPath.startsWith("/")?r.adUnitPath:`/${r.networkCode}/${r.adUnitPath}`;if(r.isOutOfPage)this.currentSlot=window.googletag.defineOutOfPageSlot(c,i);else {let l=r.sizes||[[640,480]];this.currentSlot=window.googletag.defineSlot(c,l,i);}if(!this.currentSlot){e.debug&&console.error("GAMAdapter: Failed to define slot"),this.cleanup(i,d),t("error");return}this.currentSlot.addService(window.googletag.pubads()),r.targeting&&Object.entries(r.targeting).forEach(([l,J])=>{this.currentSlot.setTargeting(l,J);}),this.currentSlot.setTargeting("ad_type",e.kind);let g=window.googletag.pubads();g.enableSingleRequest(),g.disableInitialLoad(),window.googletag.enableServices();let D=!1,K=!1,O=g.addEventListener("slotRenderEnded",l=>{l.slot===this.currentSlot&&(e.debug&&console.log("GAMAdapter: Slot render ended",{isEmpty:l.isEmpty,size:l.size,advertiserId:l.advertiserId}),l.isEmpty?s||(s=!0,n&&clearTimeout(n),e.onEvent("no_fill",{}),this.cleanup(i,d),t("no_fill")):(D=!0,d.style.display="block",e.onEvent("loaded",{})));}),x=g.addEventListener("impressionViewable",l=>{l.slot===this.currentSlot&&(e.debug&&console.log("GAMAdapter: Impression viewable"),K||(K=!0,e.onEvent("started",{})));}),U=g.addEventListener("slotVisibilityChanged",l=>{l.slot===this.currentSlot&&e.debug&&console.log("GAMAdapter: Visibility changed",{inViewPercentage:l.inViewPercentage});});window.googletag.display(i),g.refresh([this.currentSlot]),n=window.setTimeout(()=>{s||(s=!0,e.debug&&console.log("GAMAdapter: Timeout reached"),g.removeEventListener(O),g.removeEventListener(x),g.removeEventListener(U),this.cleanup(i,d),t("timeout"));},o),D&&setTimeout(()=>{!s&&D&&(s=!0,n&&clearTimeout(n),g.removeEventListener(O),g.removeEventListener(x),g.removeEventListener(U),e.onEvent("complete",{}),this.cleanup(i,d),t("ok"));},3e4);}catch(c){e.debug&&console.error("GAMAdapter: Error",c),s||(s=true,n&&clearTimeout(n),this.cleanup(i,d),t("error"));}});})}cleanup(r,e){try{this.currentSlot&&(window.googletag?.destroySlots([this.currentSlot]),this.currentSlot=null),e&&e.parentNode&&e.parentNode.removeChild(e);}catch{}}destroy(){this.currentSlot&&(window.googletag?.destroySlots([this.currentSlot]),this.currentSlot=null),this.loaded=false,this.loadPromise=null;}};A();var C=class{constructor(){this.prebidAdapter=null;this.gamAdapter=null;this.vastAdapter=null;}async executeWaterfall(r,e){if(!r||r.length===0)return e.debug&&console.log("WaterfallManager: No sources configured"),"no_fill";e.debug&&console.log("WaterfallManager: Starting waterfall",{sources:r.map(t=>t.type),kind:e.kind});for(let t=0;t<r.length;t++){let i=r[t];e.debug&&console.log(`WaterfallManager: Trying source ${t+1}/${r.length}`,{type:i.type});try{let o=await this.trySource(i,e);if(o==="ok")return e.debug&&console.log(`WaterfallManager: Source ${t+1} succeeded`,{type:i.type}),"ok";e.debug&&console.log(`WaterfallManager: Source ${t+1} failed`,{type:i.type,result:o});}catch(o){e.debug&&console.error(`WaterfallManager: Source ${t+1} error`,o);}}return e.debug&&console.log("WaterfallManager: All sources failed"),"no_fill"}async trySource(r,e){switch(r.type){case "prebid":return this.tryPrebid(r,e);case "gam":return this.tryGAM(r,e);case "vast":return this.tryVAST(r,e);default:return e.debug&&console.warn("WaterfallManager: Unknown source type",{type:r.type}),"error"}}async tryPrebid(r,e){if(!r.prebid)return e.debug&&console.warn("WaterfallManager: Prebid config missing"),"error";if(r.prebid.enabled===false)return e.debug&&console.log("WaterfallManager: Prebid disabled"),"no_fill";try{return this.prebidAdapter||(this.prebidAdapter=new S,await this.prebidAdapter.load()),await this.prebidAdapter.play(r.prebid,e)}catch(t){return e.debug&&console.error("WaterfallManager: Prebid error",t),"error"}}async tryGAM(r,e){if(!r.gam)return e.debug&&console.warn("WaterfallManager: GAM config missing"),"error";if(r.gam.enabled===false)return e.debug&&console.log("WaterfallManager: GAM disabled"),"no_fill";try{return this.gamAdapter||(this.gamAdapter=new E,await this.gamAdapter.load()),await this.gamAdapter.play(r.gam,e)}catch(t){return e.debug&&console.error("WaterfallManager: GAM error",t),"error"}}async tryVAST(r,e){if(!r.vastTags||r.vastTags.length===0)return e.debug&&console.warn("WaterfallManager: VAST tags missing"),"error";try{this.vastAdapter||(this.vastAdapter=new h,await this.vastAdapter.load());for(let t of r.vastTags){e.debug&&console.log("WaterfallManager: Trying VAST tag",{tag:t});let i=await this.vastAdapter.play(t,e);if(i==="ok")return "ok";e.debug&&console.log("WaterfallManager: VAST tag failed",{tag:t,result:i});}return "no_fill"}catch(t){return e.debug&&console.error("WaterfallManager: VAST error",t),"error"}}destroy(){this.prebidAdapter&&(this.prebidAdapter.destroy?.(),this.prebidAdapter=null),this.gamAdapter&&(this.gamAdapter.destroy?.(),this.gamAdapter=null),this.vastAdapter&&(this.vastAdapter.destroy?.(),this.vastAdapter=null);}};function T(){return new Promise(a=>{let r={npa:0};if(typeof window.__tcfapi!="function"){a(r);return}let e=setTimeout(()=>{a(r);},1e3);try{window.__tcfapi("getTCData",2,(t,i)=>{if(clearTimeout(e),!i||!t){a(r);return}let o={gdpr:t.gdprApplies?1:0,tcString:t.tcString,npa:0};t.gdprApplies&&t.purpose&&t.purpose.consents&&(t.purpose.consents[1]===!0||(o.npa=1)),a(o);});}catch(t){clearTimeout(e),console.warn("GBSDK: Error getting TCF data:",t),a(r);}})}R();var P="1.0.0";var M=class extends f{constructor(){super(...arguments);this.state={initialized:false,config:{},sessionData:{interstitial:{lastShown:0,count:0},rewarded:{lastShown:0,count:0}}};this.remoteConfig=null;this.waterfallManager=null;this.userGestureRequired=true;}async init(e={}){if(this.state.initialized){e.debug&&console.warn("GBSDK: Already initialized, skipping re-initialization");return}let t=this.detectGameMetadata(),i=this.buildAutoConfig(t,e);if(this.state.config={refreshSec:900,cooldownSec:90,sessionCap:20,debug:false,storageKey:"gbsdk",allowDomains:[],...i},this.state.config.debug&&console.log(`GBSDK v${P}: Initializing with auto-detected metadata:`,{gameMetadata:t,config:this.state.config}),this.loadSessionData(),this.state.config.configUrl){this.remoteConfig=new b({url:this.state.config.configUrl,storageKey:this.state.config.storageKey,refreshSec:this.state.config.refreshSec,allowDomains:this.state.config.allowDomains||[],publicKey:this.state.config.publicKey,auth:this.state.config.configAuth,debug:this.state.config.debug});try{let o=await this.remoteConfig.fetch();o&&(this.state.remoteConfig=o),this.state.config.debug&&console.log("GBSDK: Remote config loaded:",this.state.remoteConfig);}catch(o){console.warn("GBSDK: Failed to load remote config:",o);}}this.waterfallManager=new C,this.state.adapter=new h,await this.state.adapter.load(),this.state.overlay=z(),this.setupOverlayEvents(),this.injectCSS(),this.state.initialized=true,this.state.config.debug&&console.log("GBSDK: Initialization complete");}async showInterstitial(){return this.showAd("interstitial")}async showRewarded(){return this.showAd("rewarded")}canShow(e){if(!this.state.initialized)return  false;let t=this.getEffectiveConfig(),i=this.state.sessionData[e];return !(Date.now()-i.lastShown<(t.cooldownSec||90)*1e3||i.count>=(t.sessionCap||20)||t.featureFlags&&(e==="interstitial"&&t.featureFlags.killInterstitial||e==="rewarded"&&t.featureFlags.killRewarded))}gameStarted(){this.state.config.debug&&console.log("GBSDK: Game started"),this.emit("game_started");}gameEnded(){this.state.config.debug&&console.log("GBSDK: Game ended"),this.emit("game_ended");}destroy(){this.state.adapter&&this.state.adapter.destroy?.(),this.state.overlay&&(u(this.state.overlay.overlay),this.state.overlay.overlay.remove()),this.removeAllListeners(),this.state.initialized=false;}async showAd(e){if(!this.state.initialized)return {success:false,reason:"error"};if(!this.canShow(e)){let t=this.state.sessionData[e],i=this.getEffectiveConfig();return Date.now()-t.lastShown<(i.cooldownSec||90)*1e3?{success:false,reason:"cooldown"}:t.count>=(i.sessionCap||20)?{success:false,reason:"capped"}:{success:false,reason:"blocked"}}if(this.userGestureRequired)try{this.state.adapter&&"adDisplayContainer"in this.state.adapter,this.userGestureRequired=!1;}catch{return {success:false,reason:"error"}}H(this.state.overlay.overlay),this.state.overlay?.closeBtn&&(this.state.overlay.closeBtn.style.display="none");try{let t=this.getAdSources(e);if(t&&t.length>0){let o=await this.playWaterfall(t,e);return o==="ok"||o==="skipped"&&e==="interstitial"?(this.updateSessionData(e),u(this.state.overlay.overlay),{success:!0,type:e}):o==="skipped"&&e==="rewarded"?(u(this.state.overlay.overlay),{success:!1,reason:"no_fill"}):(u(this.state.overlay.overlay),{success:!1,reason:"no_fill"})}let i=this.getAdTags(e);if(!i||i.length===0)return u(this.state.overlay.overlay),{success:!1,reason:"no_fill"};for(let o of i){let n=await this.playAdTag(o,e);if(n==="ok"||n==="skipped"&&e==="interstitial")return this.updateSessionData(e),u(this.state.overlay.overlay),{success:!0,type:e};if(n==="skipped"&&e==="rewarded")return u(this.state.overlay.overlay),{success:!1,reason:"no_fill"}}return u(this.state.overlay.overlay),{success:!1,reason:"no_fill"}}catch{return u(this.state.overlay.overlay),{success:false,reason:"error"}}}async playAdTag(e,t){if(!this.state.adapter||!this.state.overlay)return "error";let i=await T(),o={kind:t,tc:i,mount:this.state.overlay,onEvent:(n,s)=>{this.emit(n,{kind:t,...s});},debug:this.state.config.debug||false};return this.state.adapter.play(e,o)}async playWaterfall(e,t){if(!this.waterfallManager||!this.state.overlay)return "error";let i=await T(),o={kind:t,tc:i,mount:this.state.overlay,onEvent:(n,s)=>{this.emit(n,{kind:t,...s});},debug:this.state.config.debug||false};return this.waterfallManager.executeWaterfall(e,o)}getAdSources(e){let t=this.getEffectiveConfig();return t[e]?.sources?t[e].sources:null}getAdTags(e){let t=this.getEffectiveConfig();return t[e]?.tags?t[e].tags:e==="interstitial"&&this.state.config.interstitialTags?this.state.config.interstitialTags:e==="rewarded"&&this.state.config.rewardedTags?this.state.config.rewardedTags:[]}getEffectiveConfig(){let e={cooldownSec:this.state.config.cooldownSec||90,sessionCap:this.state.config.sessionCap||20,...this.state.config,...this.state.remoteConfig};if(e.ab?.groups){let t=this.selectABGroup(e.ab.bucketing||"random"),i=e.ab.groups[t];i&&Object.assign(e,i);}return e}selectABGroup(e){let t=Object.keys(this.state.remoteConfig?.ab?.groups||{});if(t.length===0)return "default";let i=Math.floor(Math.random()*t.length);return t[i]}loadSessionData(){let e=`${this.state.config.storageKey}:session`,t=w(I,e);t&&(this.state.sessionData={interstitial:t.interstitial||{lastShown:0,count:0},rewarded:t.rewarded||{lastShown:0,count:0}});}updateSessionData(e){this.state.sessionData[e]={lastShown:Date.now(),count:this.state.sessionData[e].count+1};let t=`${this.state.config.storageKey}:session`;v(I,t,this.state.sessionData);}setupOverlayEvents(){if(!this.state.overlay)return;let{closeBtn:e,video:t}=this.state.overlay;e.style.display="none",e.addEventListener("click",()=>{e.style.display!=="none"&&(u(this.state.overlay.overlay),L(t));});let i=o=>{o.key==="Escape"&&e.style.display!=="none"&&(u(this.state.overlay.overlay),L(t));};document.addEventListener("keydown",i);}detectGameMetadata(){let e=this.detectInjectedMetadata();if(e&&e.gameId)return {...e,detectionMethod:"injected"};let t=this.detectMetaTagMetadata();return t&&t.gameId?{...t,detectionMethod:"meta_tags"}:this.detectFromUrl()}detectInjectedMetadata(){return window.GBSDK_GAME_METADATA?window.GBSDK_GAME_METADATA:window.GAME_METADATA?window.GAME_METADATA:null}detectMetaTagMetadata(){let e=i=>{let o=document.querySelector(`meta[name="${i}"]`);return o?o.getAttribute("content"):null},t=e("gbsdk:game-id")||e("game-id");return t?{gameId:t,gameTitle:e("gbsdk:game-title")||e("game-title")||document.title,category:e("gbsdk:category")||e("game-category")||void 0,tags:e("gbsdk:tags")?.split(",").map(i=>i.trim())||void 0,version:e("gbsdk:version")||e("game-version")||void 0,uploadedAt:e("gbsdk:uploaded-at")||void 0}:null}detectFromUrl(){let e=window.location.href,t=window.location.hostname,i=window.location.pathname,o=[/\/games?\/([^/?]+)/i,/\/g\/([^/?]+)/i,/\/play\/([^/?]+)/i,/\/([^/?]+)\.html?$/i,/game[_-]([^/?]+)/i],n="unknown-game";for(let s of o){let d=i.match(s);if(d&&d[1]){n=d[1];break}}return n==="unknown-game"&&(n=t.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()),n=n.replace(/[^a-zA-Z0-9\-_]/g,"").toLowerCase(),{gameId:n,gameTitle:document.title||n,domain:t,portalUrl:e,detectionMethod:"url"}}buildAutoConfig(e,t){let i={...t};return !i.configUrl&&e.gameId&&(i.configUrl=this.buildConfigUrl(e)),i.debug===void 0&&(i.debug=this.isDebugEnvironment()),i}buildConfigUrl(e){let t="https://cdn.game-buster.com/config.json",i=new URLSearchParams;return i.set("game_id",e.gameId),i.set("domain",e.domain||window.location.hostname),i.set("url",encodeURIComponent(window.location.href)),i.set("title",encodeURIComponent(e.gameTitle)),i.set("detection",e.detectionMethod||"unknown"),i.set("sdk_version",P),i.set("timestamp",Date.now().toString()),e.category&&i.set("category",e.category),e.version&&i.set("game_version",e.version),`${t}?${i.toString()}`}isDebugEnvironment(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("dev")||window.location.hostname.includes("test")||window.location.hostname.includes("staging")||window.location.search.includes("debug=true")}injectCSS(){if(document.getElementById("gbsdk-styles"))return;let t=document.createElement("style");t.id="gbsdk-styles",t.textContent=ee,document.head.appendChild(t);}},ee=`
.gbsdk-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);backdrop-filter:blur(4px);z-index:999999;display:none;align-items:center;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;view-transition-name:none}.gbsdk-slot{position:relative;max-width:960px;width:90vw;aspect-ratio:16/9;background:#000;border-radius:8px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,0.3)}.gbsdk-video{width:100%;height:100%;object-fit:contain;background:#000}.gbsdk-close{position:absolute;top:16px;right:16px;width:40px;height:40px;border:none;border-radius:50%;background:rgba(0,0,0,0.7);color:white;font-size:24px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;z-index:10;line-height:1}.gbsdk-close:hover{background:rgba(0,0,0,0.9);transform:scale(1.1)}.gbsdk-close:focus{outline:2px solid #fff;outline-offset:2px}.gbsdk-close:active{transform:scale(0.95)}@media (max-width:768px){.gbsdk-slot{width:95vw;max-height:80vh}.gbsdk-close{top:12px;right:12px;width:36px;height:36px;font-size:20px}}@media (max-height:600px){.gbsdk-slot{height:80vh;width:auto;aspect-ratio:16/9}}@media (prefers-contrast:high){.gbsdk-overlay{background:rgba(0,0,0,0.95)}.gbsdk-close{background:#000;border:2px solid #fff}}@media (prefers-reduced-motion:reduce){.gbsdk-close{transition:none}.gbsdk-close:hover{transform:none}.gbsdk-close:active{transform:none}}
`;/**
 * GBSDK - GameBuster Ads SDK
 * Production-ready, zero-dependency in-game ads SDK
 * 
 * @version 1.0.0
 * @author GameBuster
 * @license MIT
 */exports.GBSDK=M;exports.SDK_VERSION=P;exports.default=M;exports.getTCF=T;Object.defineProperty(exports,'__esModule',{value:true});return exports;})({});